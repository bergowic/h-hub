service: league-parser
# app and org for use with dashboard.serverless.com
#app: your-app-name
#org: your-org-name

provider:
  name: aws
  runtime: nodejs10.x
  memorySize: 512
  timeout: 30

  region: eu-central-1

  iamRoleStatements:
    - Effect: "Allow"
      Action:
        - "sqs:SendMessage"
      Resource:
        Fn::Join:
          - ':'
          - - arn
            - aws
            - sqs
            - Ref: AWS::Region
            - Ref: AWS::AccountId
            - ${file(../config.json):game-parse-queue-name}
    - Effect: "Allow"
      Action:
        - dynamodb:GetItem
      Resource:
        Fn::Join:
          - ':'
          - - arn
            - aws
            - dynamodb
            - Ref: AWS::Region
            - Ref: AWS::AccountId
            - table/${file(../config.json):game-table-name}

  environment:
    QUEUE_NAME: ${file(../config.json):game-parse-queue-name}
    TABLE_NAME: ${file(../config.json):game-table-name}

functions:
  league-parser:
    handler: handler.parseLeague
    events:
      - sqs:
          arn:
            Fn::Join:
              - ':'
              - - arn
                - aws
                - sqs
                - Ref: AWS::Region
                - Ref: AWS::AccountId
                - ${file(../config.json):league-parse-queue-name}
          batchSize: 1

resources:
  Resources:
